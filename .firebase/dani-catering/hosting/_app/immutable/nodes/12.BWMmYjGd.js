import{s as H,e as C,a as E,c as N,b as T,p as q,g as y,f as $,q as P,i as p,h as S,r as U,v as O,t as w,d as k,j as Y,n as W}from"../chunks/scheduler.D6wPCbXW.js";import{S as A,i as B,c as d,b as g,m as h,t as _,a as b,d as v,g as J,e as G}from"../chunks/index.rrPC56Ks.js";import"../chunks/firebase.N-yeFzkF.js";import{B as M}from"../chunks/index.BFF8PE4x.js";import{C as I,a as K,b as V,c as D,d as F}from"../chunks/card-title.BD-7R_cA.js";import{C as R}from"../chunks/card-footer.Cnlpc3kq.js";import{g as z}from"../chunks/entry.BHaU7kt2.js";function L(f){let t;return{c(){t=w("Push Notifications")},l(e){t=k(e,"Push Notifications")},m(e,s){p(e,t,s)},d(e){e&&$(t)}}}function Q(f){let t;return{c(){t=w("Enable/disable push notifications from here...")},l(e){t=k(e,"Enable/disable push notifications from here...")},m(e,s){p(e,t,s)},d(e){e&&$(t)}}}function X(f){let t,e,s,a;return t=new D({props:{class:"text-3xl",$$slots:{default:[L]},$$scope:{ctx:f}}}),s=new F({props:{class:"text-md",$$slots:{default:[Q]},$$scope:{ctx:f}}}),{c(){d(t.$$.fragment),e=E(),d(s.$$.fragment)},l(i){g(t.$$.fragment,i),e=y(i),g(s.$$.fragment,i)},m(i,o){h(t,i,o),p(i,e,o),h(s,i,o),a=!0},p(i,o){const n={};o&128&&(n.$$scope={dirty:o,ctx:i}),t.$set(n);const r={};o&128&&(r.$$scope={dirty:o,ctx:i}),s.$set(r)},i(i){a||(_(t.$$.fragment,i),_(s.$$.fragment,i),a=!0)},o(i){b(t.$$.fragment,i),b(s.$$.fragment,i),a=!1},d(i){i&&$(e),v(t,i),v(s,i)}}}function Z(f){let t,e,s,a=f[1]?"subscribed":"not subscribed",i,o,n,r,u,c=f[1]&&j(f);return{c(){t=C("p"),e=w("You are "),s=C("span"),i=w(a),o=w(" to push notifications."),n=E(),c&&c.c(),r=O(),this.h()},l(l){t=N(l,"P",{class:!0});var m=T(t);e=k(m,"You are "),s=N(m,"SPAN",{class:!0});var x=T(s);i=k(x,a),x.forEach($),o=k(m," to push notifications."),m.forEach($),n=y(l),c&&c.l(l),r=O(),this.h()},h(){P(s,"class","font-semibold"),P(t,"class","mb-4 text-lg")},m(l,m){p(l,t,m),S(t,e),S(t,s),S(s,i),S(t,o),p(l,n,m),c&&c.m(l,m),p(l,r,m),u=!0},p(l,m){(!u||m&2)&&a!==(a=l[1]?"subscribed":"not subscribed")&&Y(i,a),l[1]?c?(c.p(l,m),m&2&&_(c,1)):(c=j(l),c.c(),_(c,1),c.m(r.parentNode,r)):c&&(J(),b(c,1,1,()=>{c=null}),G())},i(l){u||(_(c),u=!0)},o(l){b(c),u=!1},d(l){l&&($(t),$(n),$(r)),c&&c.d(l)}}}function tt(f){let t,e;return t=new M({props:{class:"button",$$slots:{default:[rt]},$$scope:{ctx:f}}}),t.$on("click",ft),{c(){d(t.$$.fragment)},l(s){g(t.$$.fragment,s)},m(s,a){h(t,s,a),e=!0},p(s,a){const i={};a&128&&(i.$$scope={dirty:a,ctx:s}),t.$set(i)},i(s){e||(_(t.$$.fragment,s),e=!0)},o(s){b(t.$$.fragment,s),e=!1},d(s){v(t,s)}}}function et(f){let t,e="Checking permissions...";return{c(){t=C("p"),t.textContent=e},l(s){t=N(s,"P",{"data-svelte-h":!0}),q(t)!=="svelte-1e7bb7a"&&(t.textContent=e)},m(s,a){p(s,t,a)},p:W,i:W,o:W,d(s){s&&$(t)}}}function j(f){let t,e,s,a,i;return t=new M({props:{class:"w-full",variant:"outline",$$slots:{default:[st]},$$scope:{ctx:f}}}),t.$on("click",f[2]),a=new M({props:{class:"w-full",type:"submit",variant:"secondary",$$slots:{default:[nt]},$$scope:{ctx:f}}}),{c(){d(t.$$.fragment),e=E(),s=C("form"),d(a.$$.fragment),this.h()},l(o){g(t.$$.fragment,o),e=y(o),s=N(o,"FORM",{method:!0,action:!0});var n=T(s);g(a.$$.fragment,n),n.forEach($),this.h()},h(){P(s,"method","post"),P(s,"action","?/testNotification")},m(o,n){h(t,o,n),p(o,e,n),p(o,s,n),h(a,s,null),i=!0},p(o,n){const r={};n&128&&(r.$$scope={dirty:n,ctx:o}),t.$set(r);const u={};n&128&&(u.$$scope={dirty:n,ctx:o}),a.$set(u)},i(o){i||(_(t.$$.fragment,o),_(a.$$.fragment,o),i=!0)},o(o){b(t.$$.fragment,o),b(a.$$.fragment,o),i=!1},d(o){o&&($(e),$(s)),v(t,o),v(a)}}}function st(f){let t;return{c(){t=w("Unsubscribe")},l(e){t=k(e,"Unsubscribe")},m(e,s){p(e,t,s)},d(e){e&&$(t)}}}function nt(f){let t;return{c(){t=w("Test Notification")},l(e){t=k(e,"Test Notification")},m(e,s){p(e,t,s)},d(e){e&&$(t)}}}function rt(f){let t;return{c(){t=w("Enable notifications")},l(e){t=k(e,"Enable notifications")},m(e,s){p(e,t,s)},d(e){e&&$(t)}}}function ot(f){let t,e,s,a;const i=[et,tt,Z],o=[];function n(r,u){return r[0]===null?0:r[0]===!1?1:2}return t=n(f),e=o[t]=i[t](f),{c(){e.c(),s=O()},l(r){e.l(r),s=O()},m(r,u){o[t].m(r,u),p(r,s,u),a=!0},p(r,u){let c=t;t=n(r),t===c?o[t].p(r,u):(J(),b(o[c],1,1,()=>{o[c]=null}),G(),e=o[t],e?e.p(r,u):(e=o[t]=i[t](r),e.c()),_(e,1),e.m(s.parentNode,s))},i(r){a||(_(e),a=!0)},o(r){b(e),a=!1},d(r){r&&$(s),o[t].d(r)}}}function it(f){let t;return{c(){t=w("Go To Home")},l(e){t=k(e,"Go To Home")},m(e,s){p(e,t,s)},d(e){e&&$(t)}}}function at(f){let t,e;return t=new M({props:{class:"w-full",$$slots:{default:[it]},$$scope:{ctx:f}}}),t.$on("click",f[3]),{c(){d(t.$$.fragment)},l(s){g(t.$$.fragment,s)},m(s,a){h(t,s,a),e=!0},p(s,a){const i={};a&128&&(i.$$scope={dirty:a,ctx:s}),t.$set(i)},i(s){e||(_(t.$$.fragment,s),e=!0)},o(s){b(t.$$.fragment,s),e=!1},d(s){v(t,s)}}}function ct(f){let t,e,s,a,i,o;return t=new K({props:{$$slots:{default:[X]},$$scope:{ctx:f}}}),s=new V({props:{$$slots:{default:[ot]},$$scope:{ctx:f}}}),i=new R({props:{$$slots:{default:[at]},$$scope:{ctx:f}}}),{c(){d(t.$$.fragment),e=E(),d(s.$$.fragment),a=E(),d(i.$$.fragment)},l(n){g(t.$$.fragment,n),e=y(n),g(s.$$.fragment,n),a=y(n),g(i.$$.fragment,n)},m(n,r){h(t,n,r),p(n,e,r),h(s,n,r),p(n,a,r),h(i,n,r),o=!0},p(n,r){const u={};r&128&&(u.$$scope={dirty:r,ctx:n}),t.$set(u);const c={};r&131&&(c.$$scope={dirty:r,ctx:n}),s.$set(c);const l={};r&128&&(l.$$scope={dirty:r,ctx:n}),i.$set(l)},i(n){o||(_(t.$$.fragment,n),_(s.$$.fragment,n),_(i.$$.fragment,n),o=!0)},o(n){b(t.$$.fragment,n),b(s.$$.fragment,n),b(i.$$.fragment,n),o=!1},d(n){n&&($(e),$(a)),v(t,n),v(s,n),v(i,n)}}}function lt(f){let t,e,s,a="Settings",i,o,n;return o=new I({props:{$$slots:{default:[ct]},$$scope:{ctx:f}}}),{c(){t=C("main"),e=C("div"),s=C("h1"),s.textContent=a,i=E(),d(o.$$.fragment),this.h()},l(r){t=N(r,"MAIN",{class:!0});var u=T(t);e=N(u,"DIV",{class:!0});var c=T(e);s=N(c,"H1",{class:!0,"data-svelte-h":!0}),q(s)!=="svelte-pibx0j"&&(s.textContent=a),i=y(c),g(o.$$.fragment,c),c.forEach($),u.forEach($),this.h()},h(){P(s,"class","text-4xl w-full font-semibold p-4 mb-4"),P(e,"class","flex flex-col items-center h-screen"),P(t,"class","p-4")},m(r,u){p(r,t,u),S(t,e),S(e,s),S(e,i),h(o,e,null),n=!0},p(r,[u]){const c={};u&131&&(c.$$scope={dirty:u,ctx:r}),o.$set(c)},i(r){n||(_(o.$$.fragment,r),n=!0)},o(r){b(o.$$.fragment,r),n=!1},d(r){r&&$(t),v(o)}}}function ft(){Notification.requestPermission().then(f=>{f==="granted"&&new Notification("You are now subscribed to notifications!")})}function ut(f,t,e){let s=null,a=!1;U(async()=>{e(0,s=Notification.permission==="granted"),s&&(e(1,a=await o()),a||await n())});async function i(c){try{const l=await fetch("/api/addSubscription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:c})});if(!l.ok)throw new Error(`Error saving subscription on server: ${l.statusText} (${l.status})`)}catch(l){console.error("Error sending subscription to server:",l),r()}}async function o(){if("serviceWorker"in navigator){const l=await(await navigator.serviceWorker.ready).pushManager.getSubscription();console.log("Push subscription checked:",JSON.stringify(l)),l!==null&&i(l)}return!1}async function n(){if("serviceWorker"in navigator)try{console.log("trying to subscribe");const c=await fetch("/api/vapidPubKey"),{data:l}=await c.json();console.log(l);const x=await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:l});e(1,a=!0),console.log("Push subscription:",JSON.stringify(x)),i(x)}catch(c){console.error("Error subscribing user to push notifications:",c)}}async function r(){if("serviceWorker"in navigator){const l=await(await navigator.serviceWorker.ready).pushManager.getSubscription();l&&(await l.unsubscribe(),console.log("Push subscription unsubscribed:",JSON.stringify(l)),e(1,a=!1))}}return[s,a,r,()=>z("/")]}class ht extends A{constructor(t){super(),B(this,t,ut,lt,H,{})}}export{ht as component};
